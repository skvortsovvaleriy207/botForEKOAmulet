# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Webhook –ÆKassa

–ß—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –æ—Ç –ÆKassa, –≤–∞—à –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å **–ø—É–±–ª–∏—á–Ω—ã–º IP-–∞–¥—Ä–µ—Å–æ–º** –∏ **HTTPS** (SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º).

## 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- **VPS/VDS** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Ubuntu 22.04).
- **–î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `bot.example.com`), –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ Let's Encrypt).

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Nginx –∫–∞–∫ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTPS –∑–∞–ø—Ä–æ—Å—ã –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö –±–æ—Ç—É.

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx:**
   ```bash
   sudo apt update
   sudo apt install nginx
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥:**
   –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/nginx/sites-available/bot`:
   ```nginx
   server {
       server_name bot.example.com; # –í–∞—à –¥–æ–º–µ–Ω

       location / {
           proxy_pass http://127.0.0.1:8080; # –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω –±–æ—Ç
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       }
   }
   ```

3. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ SSL:**
   ```bash
   sudo ln -s /etc/nginx/sites-available/bot /etc/nginx/sites-enabled/
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d bot.example.com
   ```

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–æ—Ç–∞
–í —Ñ–∞–π–ª–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–∫–∞–∂–∏—Ç–µ:

```ini
# –ü–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –±–æ—Ç (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å proxy_pass –≤ Nginx)
PORT=8080

# –ü–æ–ª–Ω—ã–π URL –¥–ª—è –≤–µ–±—Ö—É–∫–∞
WEBHOOK_URL=https://bot.example.com/yookassa/webhook
```

## 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa
1. –ó–∞–π–¥–∏—Ç–µ –≤ [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my).
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** -> **HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**.
3. –í –ø–æ–ª–µ **URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å:
   `https://bot.example.com/yookassa/webhook`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - `payment.succeeded` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - `payment.canceled` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

## 5. –ó–∞–ø—É—Å–∫ –ë–æ—Ç–∞
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `systemd` –∏–ª–∏ `Docker`, —á—Ç–æ–±—ã –±–æ—Ç —Ä–∞–±–æ—Ç–∞–ª –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.

**–ü—Ä–∏–º–µ—Ä systemd unit (`/etc/systemd/system/bot.service`):**
```ini
[Unit]
Description=Telegram Bot
After=network.target

[Service]
User=root
WorkingDirectory=/path/to/bot
ExecStart=/path/to/bot/venv/bin/python3 bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–õ–æ–∫–∞–ª—å–Ω–æ)
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook **–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞**, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **ngrok**:
1. –°–∫–∞—á–∞–π—Ç–µ ngrok.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `ngrok http 8080`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS —Å—Å—ã–ª–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://random-id.ngrok-free.app`).
4. –£–∫–∞–∂–∏—Ç–µ –µ—ë –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa + `/yookassa/webhook`.
